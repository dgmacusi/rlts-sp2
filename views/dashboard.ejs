<!DOCTYPE html>
<html>
  <head>
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <link type="text/css" rel="stylesheet" href="/stylesheets/materialize.min.css"  media="screen,projection"/>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script type="text/javascript" src="/javascripts/jquery.min.js"></script>
    <script type="text/javascript" src="/javascripts/materialize.min.js"></script>
    <script type="text/javascript" src="/javascripts/script.js"></script>
    <script src="http://code.highcharts.com/highcharts.js"></script>
    <script src="https://code.highcharts.com/modules/heatmap.js"></script>
    <script src="https://code.highcharts.com/modules/treemap.js"></script>
  </head>
  <body>
    <div class="navbar-fixed">
      <nav class="grey">
        <div class="nav-wrapper">
          <a href="#" class="brand-logo center">LOGO</a>
          DASHBOARD
          <ul id="nav-mobile" class="left hide-on-med-and-down">
            <li><a href="#" data-activates="slide-out" class="button-collapse show-on-large"><i class="large material-icons">menu</i></a></li>
          </ul>
          <ul id="nav-mobile" class="right hide-on-med-and-down">
            <li><a href="/signout">SIGNOUT</a></li>
          </ul>
        </div>
      </nav>
    </div>

    <div id="dashboard" name="dashboard">
      <div id="statistics" name="statistics" class="row">
        <div class="col s1 center top-stat">
          <h3><%= statistics.userSize%></h3>
          Total Users
        </div>
        <div class="col s1 center top-stat">
          <h3><%= statistics.studentSize%></h3>
          Total Students
        </div>
        <div class="col s1 center top-stat">
          <h3><%= statistics.adminSize%></h3>
          Total Administrators
        </div>
        <div class="col s1 center top-stat">
          <h3><%= statistics.teacherSize%></h3>
          Total Teachers
        </div>
        <div class="col s1 center top-stat">
          <h3><%= statistics.nonSize%></h3>
          Total Nonteaching
        </div>
        <div class="col s1 center top-stat">
          <h3><%= statistics.locationSize%></h3>
          Total Locations
        </div>
        <div class="col s1 center top-stat">
          <h3><%= statistics.classroomSize%></h3>
          Total Classrooms
        </div>
        <div class="col s1 center top-stat">
          <h3><%= statistics.facilitySize%></h3>
          Total Facilities
        </div>
        <br><br>
        <div class="col s1"></div>
        <form method="POST" action="/timelogs/search">
          <div class="input-field col s1">
            <input placeholder="From Date" type="text" class="datepicker" id="fromDate" name="fromDate">
            <label for="fromDate">From Date</label>
          </div>
          <div class="input-field col s1">
            <input placeholder="To Date" type="text" class="datepicker" id="toDate" name="toDate">
            <label for="toDate">To Date</label>
          </div>
          <div class="input-field col s1">
             <button type="submit" class="waves-effect waves-light btn"><i class="material-icons">search</i></button>
          </div>
          
        </form>
        
      </div>
      <hr>
      <div id="first-charts" class="row">
        <div class="col s7">
          <div id="heatmap" style="width:100%; height:400px;"></div>
        </div>
        <div class="col s5">
          <div id="top-locations" style="width:100%; height:400px;"></div>
        </div>
      </div>
      <div id="second-charts" class="row">
        <div class="col s7">
          <div id="system-activity" style="width:100%; height:400px;"></div>
        </div>
        <div class="col s5">
          <div id="location-activity" style="width:100%; height:400px;"></div>
        </div>
        
      </div>
      
    </div>


    <ul id="slide-out" class="side-nav">
      <li>
        <div class="app-logo">
          <img src="/images/logo-placeholder.png">
        </div>
      </li>
      <li><a class="grey white-text" href="/home"><i class="material-icons">dashboard</i>DASHBOARD</a></li>
      <li><a href="/beacons"><i class="material-icons">my_location</i>BEACONS</a></li>
      <!-- Dropdown Structure -->
      <li><a class="dropdown-button" href="/users/administrator" data-activates="user-type"><i class="material-icons">account_circle</i>USERS</a></li>
        <ul id="user-type" class="dropdown-content">
          <li><a href="/users/administrator">Administrator</a></li>
          <li><a href="/users/teacher">Teacher</a></li>
          <li><a href="/users/student">Student</a></li>
          <li><a href="/users/nonteaching">Non-teaching</a></li>
        </ul>
      <li><a class="dropdown-button" href="/location/classroom" data-activates="location-type"><i class="material-icons">location_on</i>LOCATIONS</a></li>
        <ul id="location-type" class="dropdown-content">
          <li><a href="/location/classroom">Classroom</a></li>
          <li><a href="/location/facility">Facility</a></li>
        </ul>
      <li><a href="/timelogs"><i class="material-icons">access_time</i>TIMELOGS</a></li>      
    </ul>
  </body>
  <script type="text/javascript">
    // LINE GRAPH
    $.ajax({
        url: "http://127.0.0.1:3000/dashboard/systemactivity",
        type: 'GET',
        dataType: 'json'
    }).done(function (data) {
      systemActivity(data)
    });

    var systemActivity = function (data) {
      Highcharts.chart('system-activity', {
          xAxis: {
              categories: data.categories
          },

          series: [{
              data: data.values
          }], 
          title : {
            text : "System Activity (Number of Logs/Day)"
          }
      });
    }

    $.ajax({
        url: "",
        type: 'GET',
        success: function(res) {
            topLocations("yeah")
        }
    });
    // BAR GRAPH
    var topLocations = function (yeah) {
      Highcharts.chart('top-locations', {
        chart: {
            type: 'column'
        },
        title: {
            text: 'Monthly Average Rainfall'
        },
        subtitle: {
            text: 'Source: WorldClimate.com'
        },
        xAxis: {
            categories: [
                'Jan',
                'Feb',
                'Mar',
                'Apr',
                'May'
            ],
            crosshair: true
        },
        yAxis: {
            min: 0,
            title: {
                text: 'Rainfall (mm)'
            }
        },
        tooltip: {
            headerFormat: '<span style="font-size:10px">{point.key}</span><table>',
            pointFormat: '<tr><td style="color:{series.color};padding:0">{series.name}: </td>' +
                '<td style="padding:0"><b>{point.y:.1f} mm</b></td></tr>',
            footerFormat: '</table>',
            shared: true,
            useHTML: true
        },
        plotOptions: {
            column: {
                pointPadding: 0.2,
                borderWidth: 0
            }
        },
        series: [{
            name: 'Enter',
            data: [49.9, 71.5, 106.4, 129.2, 144.0]

        }, {
            name: 'Exit',
            data: [83.6, 78.8, 98.5, 93.4, 106.0]

        }]
    });
    }

    $.ajax({
        url: "http://127.0.0.1:3000/dashboard/locationactivity",
        type: 'GET',
        dataType: 'json'
    }).done(function (data) {
      locationActivity(data)
    });

    var locationActivity = function (data) {
      Highcharts.chart('location-activity', {
          chart: {
              plotBackgroundColor: null,
              plotBorderWidth: null,
              plotShadow: false,
              type: 'pie'
          },
          title: {
              text: 'Location Activity (Total Logs Per Facility)'
          },
          tooltip: {
              pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
          },
          plotOptions: {
              pie: {
                  allowPointSelect: true,
                  cursor: 'pointer',
                  dataLabels: {
                      enabled: false
                  },
                  showInLegend: true
              }
          },
          series: [{
              name: 'Brands',
              colorByPoint: true,
              data: data.data
          }]
      });
    }

    $.ajax({
        url: "",
        type: 'GET',
        success: function(res) {
            heatMap("yeah")
        }
    });

    var heatMap = function (yeah) {
      Highcharts.chart('heatmap', {
          colorAxis: {
              minColor: '#FFFFFF',
              maxColor: Highcharts.getOptions().colors[0]
          },
          series: [{
              type: 'treemap',
              layoutAlgorithm: 'squarified',
              data: [{
                  name: 'A',
                  value: 6,
                  colorValue: 1
              }, {
                  name: 'B',
                  value: 6,
                  colorValue: 2
              }, {
                  name: 'C',
                  value: 4,
                  colorValue: 3
              }, {
                  name: 'D',
                  value: 3,
                  colorValue: 4
              }, {
                  name: 'E',
                  value: 2,
                  colorValue: 5
              }, {
                  name: 'F',
                  value: 2,
                  colorValue: 6
              }, {
                  name: 'G',
                  value: 1,
                  colorValue: 7
              }]
          }],
          title: {
              text: 'Highcharts Treemap'
          }
      });
    }
  </script>
</html>
